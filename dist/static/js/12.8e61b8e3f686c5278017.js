webpackJsonp([12],{"3pr4":function(e,t){},Q5pJ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("Dd8w"),a=s.n(n),i=s("Xxa5"),o=s.n(i),r=s("exGp"),u=s.n(r),l=s("GQaK"),c=s("NYxO"),d={name:"DialogueBox",data:function(){return{currUserDataInformation:{userId:"",userName:"",dialogueObject:this.$route.params.objectUserId,userHeadImg:"",userDialogueContent:""},bulleList:[],inputDialogueBoxContentData:[],dialogueBoxName:"",compressFrequency:0,id:"",toalHeight:0,scrollY:0}},methods:{compressFunction:function(e){var t=new Image;t.src=e;var s=document.createElement("canvas"),n=s.getContext("2d"),a=t.width/2,i=t.height/2;return s.height>200&&s.width>200?(s.width=a,s.height=i,n.drawImage(t,0,0,a,i)):(s.width=t.width,s.height=t.height,n.drawImage(t,0,0,t.width,t.height)),s.toDataURL("image/jpeg")},sendInformation:function(){var e=this;return u()(o.a.mark(function t(){var s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.compressFunction(e.currUserDataInformation.userHeadImg);case 2:s=t.sent,e.$set(e.currUserDataInformation,"userHeadImg",s),e.$socket.emit("connection",e.currUserDataInformation),e.inputDialogueBoxContentData.push(e.currUserDataInformation),e.currUserDataInformation.userDialogueContent="";case 7:case"end":return t.stop()}},t,e)}))()},judgeInformationClass:function(e,t){e.id=t;var s,n;return"self"===e.idntity?e.bulleObject="send":e.bulleObject="receive",s=e.userName,n=e.userHeadImg,{id:e.id,userId:e.userId,userName:s,userHeadImg:n,userBulleContent:e.userDialogueContent,bulleObject:e.bulleObject}},receiveInformation:function(e){console.log(e);var t=this.judgeInformationClass(e,this.bulleList.length);this.bulleList.push(t)},outdialogue:function(){this.$router.go(-1)},getDialogueBoxContent:function(){var e=this;this.$store.dispatch("user/getUserOrderInfo",{url:"/dialogueBox",params:{objectUserId:this.$route.params.objectUserId}}).then(function(t){console.log(t),null!==t?(e.inputDialogueBoxContentData=t,e.inputDialogueBoxContentData.forEach(function(t){""===e.currUserDataInformation.userName&&"self"===t.idntity&&(e.currUserDataInformation.userName=t.userName,e.currUserDataInformation.userHeadImg=t.userHeadImg);var s=e.judgeInformationClass(t,e.bulleList.length);e.bulleList.push(s),t.userId!==e.currUserDataInformation.userId&&(e.dialogueBoxName=t.userName)})):e.dialogueBoxName=t[0].userName})},setBscroll:function(){this.scroll=new l.a(this.$refs.dialogueContent,{mouseWheel:!0,click:!0,tap:!0}),this.$refs.dialogueContent.offsetHeight-this.$refs.dialogueContentWarpped.offsetHeight<100&&this.scroll.scrollTo(0,this.$refs.dialogueContent.offsetHeight-this.$refs.dialogueContentWarpped.offsetHeight,1e3)}},computed:a()({},Object(c.b)(["token"]),{dialogueContentWarppedHeight:function(){var e=0;return this.inputDialogueBoxContentData.forEach(function(t){t.userDialogueContent.length>8?e+=t.userDialogueContent.length%8:e+=1}),2.1*e}}),sockets:{connect:function(){this.id=this.$socket.id,this.$socket.emit("Bconnection",this.token)},airContent:function(e){this.$nextTick(this.receiveInformation(e))}},watch:{bulleList:{handler:function(){this.setBscroll()},deep:!0}},created:function(){this.getDialogueBoxContent()},mounted:function(){this.setBscroll(),this.currUserDataInformation.userId=this.token,this.$socket.emit("connect")},activated:function(){this.$socket.emit("Bconnection",this.token),this.setBscroll()}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dialogueBox-contrainer"},[s("div",{staticClass:"dialogueBox-head"},[s("div",{staticClass:"head-out",on:{click:e.outdialogue}},[s("span",{staticClass:"iconfont"},[e._v("")])]),e._v(" "),s("div",{staticClass:"head-userTitle"},[s("span",{staticClass:"userTitle"},[e._v(e._s(e.dialogueBoxName))])])]),e._v(" "),s("div",{ref:"dialogueContent",staticClass:"dialogueBox-dialogueContent"},[s("div",{ref:"dialogueContentWarpped",staticClass:"dialogueContent-warpped",style:{height:e.dialogueContentWarppedHeight+"rem"}},e._l(e.bulleList,function(t){return s("div",{key:t.id},["receive"===t.bulleObject?s("div",{staticClass:"dialogueContent-bulleReceive"},[s("div",{staticClass:"bulleReceive-img"},[s("img",{staticClass:"img",attrs:{src:t.userHeadImg}})]),e._v(" "),s("span",{staticClass:"bulleReceive-userName"},[e._v(e._s(t.userName))]),e._v(" "),s("div",{staticClass:"bulleReceive-container"},[s("span",{staticClass:"bulleReceive-content"},[e._v(e._s(t.userBulleContent))])])]):s("div",{staticClass:"dialogueContent-bulleSend"},[s("div",{staticClass:"bulleSend-img"},[s("img",{staticClass:"img",attrs:{src:t.userHeadImg}})]),e._v(" "),s("span",{staticClass:"bulleSend-userName"},[e._v(e._s(t.userName))]),e._v(" "),s("div",{staticClass:"bulleSend-container"},[s("span",{staticClass:"bulleSend-content"},[e._v(e._s(t.userBulleContent))])])])])}),0)]),e._v(" "),s("div",{staticClass:"dialogueBox-userInput"},[s("div",{staticClass:"userInput-InputBox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.currUserDataInformation.userDialogueContent,expression:"currUserDataInformation.userDialogueContent"}],staticClass:"InputBox-contnet",attrs:{type:"text"},domProps:{value:e.currUserDataInformation.userDialogueContent},on:{input:function(t){t.target.composing||e.$set(e.currUserDataInformation,"userDialogueContent",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"userInput-sendBtn"},[s("a",{staticClass:"sendBtn",attrs:{href:"javascript:"},on:{click:e.sendInformation}},[e._v("发送")])])])])},staticRenderFns:[]};var m=s("VU/8")(d,g,!1,function(e){s("3pr4")},"data-v-a8b0fb5c",null);t.default=m.exports}});
//# sourceMappingURL=12.8e61b8e3f686c5278017.js.map